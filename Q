warning: CRLF will be replaced by LF in edu_wifi_clock/main/usr_aip1638.c.
The file will have its original line endings in your working directory
[1mdiff --git a/edu_led_strip_ws2812/main/led_strip_main.c b/edu_led_strip_ws2812/main/led_strip_main.c[m
[1mindex 71f7f7c..804c974 100644[m
[1m--- a/edu_led_strip_ws2812/main/led_strip_main.c[m
[1m+++ b/edu_led_strip_ws2812/main/led_strip_main.c[m
[36m@@ -13,6 +13,9 @@[m
 #include "driver/rmt.h"[m
 #include "led_strip.h"[m
 [m
[32m+[m[32m#include <time.h>[m
[32m+[m[32m#include <sys/time.h>[m
[32m+[m
 static const char *TAG = "example";[m
 [m
 #define RMT_TX_CHANNEL RMT_CHANNEL_0[m
[36m@@ -96,21 +99,52 @@[m [mvoid app_main(void)[m
     ESP_ERROR_CHECK(strip->clear(strip, 100));[m
     // Show simple rainbow chasing pattern[m
     ESP_LOGI(TAG, "LED Rainbow Chase Start");[m
[32m+[m
[32m+[m[32m    time_t now;[m
[32m+[m[32m    struct tm timeinfo;[m
[32m+[m[32m    time(&now);[m
[32m+[m[32m    localtime_r(&now, &timeinfo);[m
[32m+[m
[32m+[m[32m    ESP_LOGI(TAG, "time:%d:%d:%d",timeinfo.tm_hour, timeinfo.tm_min, timeinfo.tm_sec);[m
[32m+[m
     while (true) {[m
[31m-        {[m
[31m-            for (int j = 0; j < CONFIG_EXAMPLE_STRIP_LED_NUMBER; j ++) {[m
[31m-                // Build RGB values[m
[31m-                hue = j * 360 / CONFIG_EXAMPLE_STRIP_LED_NUMBER + start_rgb;[m
[31m-                led_strip_hsv2rgb(hue, 90, 5, &red, &green, &blue);[m
[31m-                // Write RGB values to strip driver[m
[31m-                ESP_ERROR_CHECK(strip->set_pixel(strip, j, red, green, blue));[m
[31m-            }[m
[31m-            // Flush RGB values to LEDs[m
[31m-            ESP_ERROR_CHECK(strip->refresh(strip, 100));[m
[31m-            vTaskDelay(pdMS_TO_TICKS(EXAMPLE_CHASE_SPEED_MS));[m
[31m-//            strip->clear(strip, 50);[m
[31m-//            vTaskDelay(pdMS_TO_TICKS(EXAMPLE_CHASE_SPEED_MS));[m
[31m-        }[m
[31m-        start_rgb += 60;[m
[32m+[m[41m    [m	[32mtime(&now);[m
[32m+[m		[32mlocaltime_r(&now, &timeinfo);[m
[32m+[m		[32mESP_LOGI(TAG, "time:%d:%d:%d",timeinfo.tm_hour, timeinfo.tm_min, timeinfo.tm_sec);[m
[32m+[m
[32m+[m		[32mfor (int j = 0; j < CONFIG_EXAMPLE_STRIP_LED_NUMBER; j += 1) {[m
[32m+[m			[32m// Build RGB values[m
[32m+[m			[32mhue = j * 360 / CONFIG_EXAMPLE_STRIP_LED_NUMBER + start_rgb;[m
[32m+[m			[32mled_strip_hsv2rgb(hue, 100, 1, &red, &green, &blue);[m
[32m+[m			[32m// Write RGB values to strip driver[m
[32m+[m			[32mESP_ERROR_CHECK(strip->set_pixel(strip, j, red, green, blue));[m
[32m+[m
[32m+[m			[32m// ÅÐ¶ÏÐ¡Ê±[m
[32m+[m			[32mif(((timeinfo.tm_hour%12)*5 + timeinfo.tm_min/60*5) == (j+1)) {[m
[32m+[m				[32m// ÖØÐÂÅäÖÃµ±Ç°LEDµÄÑÕÉ«[m
[32m+[m				[32mled_strip_hsv2rgb(240, 100, 10, &red, &green, &blue);[m
[32m+[m				[32mESP_ERROR_CHECK(strip->set_pixel(strip, j, red, green, blue));[m
[32m+[m			[32m}[m
[32m+[m
[32m+[m			[32m// ÅÐ¶Ï·ÖÖÓ[m
[32m+[m			[32mif(timeinfo.tm_min == (j+1)) {[m
[32m+[m				[32m// ÖØÐÂÅäÖÃµ±Ç°LEDµÄÑÕÉ«[m
[32m+[m				[32mled_strip_hsv2rgb(120, 100, 10, &red, &green, &blue);[m
[32m+[m				[32mESP_ERROR_CHECK(strip->set_pixel(strip, j, red, green, blue));[m
[32m+[m			[32m}[m
[32m+[m			[32m// ÅÐ¶ÏÃë[m
[32m+[m			[32mif(timeinfo.tm_sec == (j+1)) {[m
[32m+[m				[32m// ÖØÐÂÅäÖÃµ±Ç°LEDµÄÑÕÉ«[m
[32m+[m				[32mled_strip_hsv2rgb(0, 100, 10, &red, &green, &blue);[m
[32m+[m				[32mESP_ERROR_CHECK(strip->set_pixel(strip, j, red, green, blue));[m
[32m+[m			[32m}[m
[32m+[m		[32m}[m
[32m+[m
[32m+[m		[32m// Flush RGB values to LEDs[m
[32m+[m		[32mESP_ERROR_CHECK(strip->refresh(strip, 100));[m
[32m+[m		[32mvTaskDelay(pdMS_TO_TICKS(EXAMPLE_CHASE_SPEED_MS));[m
[32m+[m[32m//		strip->clear(strip, 50);[m
[32m+[m[32m//		vTaskDelay(pdMS_TO_TICKS(EXAMPLE_CHASE_SPEED_MS));[m
[32m+[m
     }[m
 }[m
[1mdiff --git a/edu_wifi_clock/main/usr_aip1638.c b/edu_wifi_clock/main/usr_aip1638.c[m
[1mindex 3aeff94..5cf646f 100644[m
[1m--- a/edu_wifi_clock/main/usr_aip1638.c[m
[1m+++ b/edu_wifi_clock/main/usr_aip1638.c[m
[36m@@ -98,7 +98,7 @@[m [mbit 7   6   5   4   3   2   1   0[m
     0   0   1   1   1   1   1   0   3E  U[m
 *******************/[m
 uint8_t seg_font_table[]={0x3F, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f, 0x40, 0x80, 0x7b, 0x39, 0x79, 0x71, 0x76, 0x38, 0x3E};[m
[31m-uint8_t data_buf[16] = {0xc0, 0x00};[m
[32m+[m[32muint8_t data_buf[17] = {0xc0, 0x00};[m
 [m
 void aip1638_usr_buf_write(uint8_t offset, uint8_t seg_font)[m
 {[m
[36m@@ -130,7 +130,7 @@[m [mvoid aip1638_update(spi_device_handle_t spi, uint8_t *data_buf)[m
     uint8_t disp_cmd = 0x8F;[m
 [m
     spi_aip1638_write(spi, &data_cmd, 1);[m
[31m-    spi_aip1638_write(spi, data_buf, 16);[m
[32m+[m[32m    spi_aip1638_write(spi, data_buf, 17);[m
     spi_aip1638_write(spi, &disp_cmd, 1);[m
 }[m
 [m
